 /*
 * AutoSuggest
 * Copyright 2009-2010 Drew Wilson
 * www.drewwilson.com
 * https://github.com/drewwilson/AutoSuggest
 *
 * Version 1.4   -   Updated: Mar. 23, 2010
 *
 * This Plug-In will auto-complete or auto-suggest completed search queries
 * for you as you type. You can add multiple selections and remove them on
 * the fly. It supports keybord navigation (UP + DOWN + RETURN), as well
 * as multiple AutoSuggest fields on the same page.
 *
 * Inspied by the Autocomplete plugin by: JÅ¡rn Zaefferer
 * and the Facelist plugin by: Ian Tearle (iantearle.com)
 *
 * This AutoSuggest jQuery plug-in is dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
!function(e){e.fn.autoSuggest=function(t,s){var l={asHtmlID:!1,startText:"Enter Name Here",emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",retrieveLimit:!1,extraParams:"",matchCase:!1,minChars:1,keyDelay:400,clearQuery:1,resultsHighlight:!0,neverSubmit:!1,selectionLimit:!1,showResultList:!0,start:function(){},selectionClick:function(e){},selectionAdded:function(e){},selectionRemoved:function(e){e.remove()},formatList:!1,beforeRetrieve:function(e){return e},retrieveComplete:function(e){return e},resultClick:function(e){},resultsComplete:function(){}},a=e.extend(l,s),i="object",r=0;if("string"==typeof t){i="string";var o=t}else{var n=t;for(k in t)t.hasOwnProperty(k)&&r++}return"object"==i&&r>0||"string"==i?this.each(function(t){function s(){if(46==lastKeyPressCode||lastKeyPressCode>8&&lastKeyPressCode<32)return p.hide();var t=d.val().replace(/[\\]+|[\/]+/g,"");if(t!=I)if(I=t,t.length>=a.minChars)if(h.addClass("loading"),"string"==i){var s="";a.retrieveLimit&&(s="&limit="+encodeURIComponent(a.retrieveLimit)),a.beforeRetrieve&&(t=a.beforeRetrieve.call(this,t)),e.getJSON(o+"?"+a.queryParam+"="+encodeURIComponent(t)+s+a.extraParams,function(e){r=0;var s=a.retrieveComplete.call(this,e);for(k in s)s.hasOwnProperty(k)&&r++;l(s,t)})}else a.beforeRetrieve&&(t=a.beforeRetrieve.call(this,t)),l(n,t);else h.removeClass("loading"),p.hide()}function l(t,s){a.matchCase||(s=s.toLowerCase());var l=0;p.html(C.html("")).hide();for(var i=0;r>i;i++){var o=i;F++;var n=!1;if("value"==a.searchObjProps)var v=t[o].value;else for(var v="",u=a.searchObjProps.split(","),f=0;f<u.length;f++){var b=e.trim(u[f]);v=v+t[o][b]+" "}if(v&&(a.matchCase||(v=v.toLowerCase()),-1!=v.search(s)&&-1==g.val().search(","+t[o][a.selectedValuesProp]+",")&&(n=!0)),n){var k=e('<li class="as-result-item" id="as-result-item-'+o+'"></li>').click(function(){var t=e(this).data("data"),s=t.num;if(e("#as-selection-"+s,h).length<=0&&!D){var l=t.attributes;d.val("").focus(),I="",c(l,s),a.resultClick.call(this,t),p.hide()}D=!1}).mousedown(function(){m=!1}).mouseover(function(){e("li",C).removeClass("active"),e(this).addClass("active")}).data("data",{attributes:t[o],num:F}),P=e.extend({},t[o]);if(a.matchCase)var y=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+s+")(?![^<>]*>)(?![^&;]+;)","g");else var y=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+s+")(?![^<>]*>)(?![^&;]+;)","gi");if(a.resultsHighlight&&(P[a.selectedItemProp]=P[a.selectedItemProp].replace(y,"<em>$1</em>")),k=a.formatList?a.formatList.call(this,P,k):k.html(P[a.selectedItemProp]),C.append(k),delete P,l++,a.retrieveLimit&&a.retrieveLimit==l)break}}h.removeClass("loading"),0>=l&&C.html('<li class="as-message">'+a.emptyText+"</li>"),C.css("width",h.outerWidth()),p.show(),a.resultsComplete.call(this)}function c(t,s){g.val(g.val()+t[a.selectedValuesProp]+",");var l=e('<li class="as-selection-item" id="as-selection-'+s+'"></li>').click(function(){a.selectionClick.call(this,e(this)),h.children().removeClass("selected"),e(this).addClass("selected")}).mousedown(function(){m=!1}),i=e('<a class="as-close">&times;</a>').click(function(){return g.val(g.val().replace(","+t[a.selectedValuesProp]+",",",")),a.selectionRemoved.call(this,l),m=!0,d.focus(),!1});f.before(l.html(t[a.selectedItemProp]).prepend(i)),a.selectionAdded.call(this,f.prev())}function v(t){if(e(":visible",p).length>0){var s=e("li",p);if("down"==t)var l=s.eq(0);else var l=s.filter(":last");var a=e("li.active:first",p);a.length>0&&(l="down"==t?a.next():a.prev()),s.removeClass("active"),l.addClass("active")}}if(a.asHtmlID){t=a.asHtmlID;var u=t}else{t=t+""+Math.floor(100*Math.random());var u="as-input-"+t}a.start.call(this);var d=e(this);d.attr("autocomplete","off").addClass("as-input").attr("id",u).val(a.startText);var m=!1;d.wrap('<ul class="as-selections" id="as-selections-'+t+'"></ul>').wrap('<li class="as-original" id="as-original-'+t+'"></li>');var h=e("#as-selections-"+t),f=e("#as-original-"+t),p=e('<div class="as-results" id="as-results-'+t+'"></div>').hide(),C=e('<ul class="as-list"></ul>'),g=e('<input type="hidden" class="as-values" name="as_values_'+t+'" id="as-values-'+t+'" />'),b="";if("string"==typeof a.preFill){for(var P=a.preFill.split(","),y=0;y<P.length;y++){var w={};w[a.selectedValuesProp]=P[y],""!=P[y]&&c(w,"000"+y)}b=a.preFill}else{b="";var x=0;for(k in a.preFill)a.preFill.hasOwnProperty(k)&&x++;if(x>0)for(var y=0;x>y;y++){var L=a.preFill[y][a.selectedValuesProp];void 0==L&&(L=""),b=b+L+",",""!=L&&c(a.preFill[y],"000"+y)}}if(""!=b){d.val("");var R=b.substring(b.length-1);","!=R&&(b+=","),g.val(","+b),e("li.as-selection-item",h).addClass("blur").removeClass("selected")}d.after(g),h.click(function(){m=!0,d.focus()}).mousedown(function(){m=!1}).after(p);var T=null,I="",D=!1;d.focus(function(){return e(this).val()==a.startText&&""==g.val()?a.clearQuery&&e(this).val(""):m&&(e("li.as-selection-item",h).removeClass("blur"),""!=e(this).val()&&(C.css("width",h.outerWidth()),p.show())),m=!0,!0}).blur(function(){""==e(this).val()&&""==g.val()&&""==b?e(this).val(a.startText):m&&(e("li.as-selection-item",h).addClass("blur").removeClass("selected"),p.hide())}).keydown(function(t){switch(lastKeyPressCode=t.keyCode,first_focus=!1,t.keyCode){case 38:t.preventDefault(),v("up");break;case 40:t.preventDefault(),v("down");break;case 8:if(""==d.val()){var l=g.val().split(",");l=l[l.length-2],h.children().not(f.prev()).removeClass("selected"),f.prev().hasClass("selected")?(g.val(g.val().replace(","+l+",",",")),a.selectionRemoved.call(this,f.prev())):(a.selectionClick.call(this,f.prev()),f.prev().addClass("selected"))}1==d.val().length&&(p.hide(),I=""),e(":visible",p).length>0&&(T&&clearTimeout(T),T=setTimeout(function(){s()},a.keyDelay));break;case 9:case 188:D=!0;var i=d.val().replace(/(,)/g,"");if(""!=i&&g.val().search(","+i+",")<0&&i.length>=a.minChars){t.preventDefault();var r={};r[a.selectedItemProp]=i,r[a.selectedValuesProp]=i;var o=e("li",h).length;c(r,"00"+(o+1)),d.val("")}case 13:D=!1;var n=e("li.active:first",p);n.length>0&&(n.click(),p.hide()),(a.neverSubmit||n.length>0)&&t.preventDefault();break;default:a.showResultList&&(a.selectionLimit&&e("li.as-selection-item",h).length>=a.selectionLimit?(C.html('<li class="as-message">'+a.limitText+"</li>"),p.show()):(T&&clearTimeout(T),T=setTimeout(function(){s()},a.keyDelay)))}});var F=0}):void 0}}(jQuery);